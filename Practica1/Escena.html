<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Escenario Geométrico WebGL</title>
</head>
<body>
  <canvas id="webglcanvas" width="900" height="570"></canvas>

  <!-- Vertex Shader -->
  <script id="vs" type="x-shader/x-vertex">
    #version 300 es
    layout(location = 0) in vec2 aVertices;
    layout(location=1) in vec4 aColores;  //(r,g,b,a)
    uniform mat4 uMatrizProyeccion;
    uniform mat4 uMatrizVista;
    uniform mat4 uMatrizModelo;
    void main() {
      gl_Position = uMatrizProyeccion * uMatrizVista * uMatrizModelo * vec4(aVertices, 0.0, 1.0);
      gl_PointSize = 3.0; 
    }
  </script>

  <!-- Fragment Shader -->
  <script id="fs" type="x-shader/x-fragment">
    #version 300 es
    precision mediump float;
    uniform vec4 uColor;
    out vec4 fragColor;
    void main() {
      fragColor = uColor;
    }
  </script>

  <script>
    let gl, programaID;
    let MatrizProyeccion = new Array(16);
    let MatrizVista = new Array(16);
    let MatrizModelo = new Array(16);

    function identidad(m) {
      m[0]=1;m[4]=0;m[8]=0;m[12]=0;
      m[1]=0;m[5]=1;m[9]=0;m[13]=0;
      m[2]=0;m[6]=0;m[10]=1;m[14]=0;
      m[3]=0;m[7]=0;m[11]=0;m[15]=1;
    }

    function ortho(r, izq, der, abj, arr, cerca, lejos) {
      r[0] = 2/(der - izq); r[4] = 0; r[8] = 0; r[12] = -(der+izq)/(der-izq);
      r[1] = 0; r[5] = 2/(arr-abj); r[9] = 0; r[13] = -(arr+abj)/(arr-abj);
      r[2] = 0; r[6] = 0; r[10] = -2/(lejos-cerca); r[14] = -(lejos+cerca)/(lejos-cerca);
      r[3] = 0; r[7] = 0; r[11] = 0; r[15] = 1;
    }

    function multiplica(c, a, b) {
      let r = new Array(16);
      for (let i=0;i<4;i++){
        for (let j=0;j<4;j++){
          let s=0;
          for (let k=0;k<4;k++) s += a[i+k*4]*b[k+j*4];
          r[i+j*4] = s;
        }
      }
      for(let i=0;i<16;i++) c[i]=r[i];
    }

    function compilarShader(tipo, src){
      let shader = gl.createShader(tipo);
      gl.shaderSource(shader, src);
      gl.compileShader(shader);
      if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)){
        console.error(gl.getShaderInfoLog(shader));
      }
      return shader;
    }

    function crearCirculo(radio, cx, cy, nSegmentos=50) {
      let vertices = [cx, cy]; // centro
      for(let i=0;i<=nSegmentos;i++){
        let ang = i*2*Math.PI/nSegmentos;
        vertices.push(cx + radio*Math.cos(ang));
        vertices.push(cy + radio*Math.sin(ang));
      }

        let vao = gl.createVertexArray();
        gl.bindVertexArray(vao);

        let vbo = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
        gl.enableVertexAttribArray(0);
        gl.vertexAttribPointer(0,2,gl.FLOAT,false,0,0);

        gl.bindVertexArray(null);
        return {vao: vao, numVertices: vertices.length/2};
      }

       function crearEstrellas(coords) {
          const vao = gl.createVertexArray();
          gl.bindVertexArray(vao);

          const vbo = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
          gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(coords), gl.STATIC_DRAW);
          gl.enableVertexAttribArray(0);
          gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);

          gl.bindVertexArray(null);
          return { vao: vao, numVertices: coords.length / 2 };
    }


    function main(){
      const canvas = document.getElementById("webglcanvas");
      gl = canvas.getContext("webgl2");
      gl.viewport(0,0,canvas.width,canvas.height);

      const vs = compilarShader(gl.VERTEX_SHADER, document.getElementById("vs").text.trim());
      const fs = compilarShader(gl.FRAGMENT_SHADER, document.getElementById("fs").text.trim());

      programaID = gl.createProgram();
      gl.attachShader(programaID, vs);
      gl.attachShader(programaID, fs);
      gl.linkProgram(programaID);
      gl.useProgram(programaID);

   
      // Vértices escenario
      const vertices = [
        
        //3
        -5.3,-5,
        7,-5,
        0, 1.3,
        //3
       -10,-5,
       -2.3,-5,
       -10,-0.3,
       //3
       3.8,-4.12,
        10,-4.9,
        10,-0.4,
      //4
        0,1.3,
        -2.3,-1.37,
        -1.4,-1,
        0,0.3,
        //12
        1.35,0.07,
        3.5,2,
        4.4,1.39,
        6,-0.64,
        6.2,-0.5,
        6.9,-0.6,
        6.7,-0.3,
        8.18,-1.5,
        5,-3.59,
        3.5,-1.9,//
        2.8,-1.5,
        2.7,-1.19,
        //4
        1.43,0.05,
        3.5,2,
        3.6,1.4,
        1.8,-0.3,
        //4
        1.7,-0.3,
        3.6,1.3,
        3.4,0.2,
        2.2,-0.8,
        //3
        2,-0.65,
        2.5,-1.2,
        3.4,0.2,
        //7
        3.4,-2,
        4.2,-1.2,
        4.4,-1.6,
        4.6,-1.3,
        4.8,-1.6,
        4.4,-1.9,
        3.7,-2.3,
        //10
        3.6,-2.2,
        4.5,-2,
        4.8,-1.68,
        5.3,-1.2,
        5.4,-1.5,
        6.2,-1.6,
        5.8,-2.9,
        4.2,-2.8,
        5.1,-3.4,
        4.6,-3,
        //4
        -10,-4,
        10,-4,
        10,-5,
        -10,-5,
        //7
        -5,0.1,
        -2.9,2.6,
        -1.8,1.6,
        -1.6,1.6,
        -1.3,0.8,
        -0.7,0.5,
        -0.9,0.25,
        //6
        -2.9,2.6,
        -1.8,1.6,
        -1.6,1.6,
        -1.3,0.8,
        -0.7,0.5,
        -2.8,0.4,
        //10

        -2.89,2.1, //l
        -2.9,1.3, //k
        -3.8,0.5, //j
        -4.3,0.6, //i
        -4.76,0.4, //h
        -5.0,0.1, //g
        -1.38,-0.3, //p
        -0.7,0.5,   //o
        -1.2,1, //n
        -1.6,1, //m
        -2.89,2.1, //l
        
        -4.3,-3.86,
        -1.9,-0.94,
        -8.4,-1.3,
        
       
        -1.9,-0.94,        
        -1.27,-0.16,
        -1.67,0.33,
        -1.8,0.12,

        -1.9,-0.94, 
        -1.8,0.12,
        -1.9,0.25,
        -2.0,0.0,
       
        -1.9,-0.94, 
        -2.0,0.0,
        -2.64,1.2,
        -2.9,0.66,

        -1.9,-0.94, 
        -2.9,0.66,
        -3.1,1.0,
        -3.8,0.0,

        -1.9,-0.94, 
        -3.8,0.0,
        -4.8,0.16,
        -5.54,0.17,

        -1.9,-0.94, 
        -5.54,0.17,
        -6.7,0.67,
        -8.56,-0.25,

        -1.9,-0.94, 
        -8.56,-0.25,
        -9.09,-0.01,
        -9.32,-0.01,

        -1.9,-0.94, 
        -9.32,-0.01,
        -9.7,-0.48,
        -8.3,-1.3,

        0.0,0.33,
        -1.5,-1,
        -2.3,-1.4,
        -5.2,-5,
        -3.6,-4.2,
        0.0,-0.41,

        3.7,-4.19,
        5,-3.59,
        4.46,-2.5,

        5,-3.59,
        5.36,-3.44,
        5.19,-3.11,

        5.36,-3.44,
        5.79,-3.12,
        5.5,-2.61,

        5.79,-3.12,
        6.5,-3,
        6,-2.1,

        -1.55,-4.16,
        -0.59,-4.27,
        -1.19,-3.17,

        -0.8,-4.27,
        0.38,-4,
        -0.07,-3.23,

         0.38,-4,
         0.9,-3.8,
         0.6,-3.1,

         0.9,-3.8,
         1.65,-3.67,
         1.41,-2.68,

         1.65,-3.67,
         2.26,-3.67,
         1.85,-3.24,

         2.26,-3.67,
         2.89,-4.22,
         2.54,-3.58,

        -1.57,-4.0,
         6,-4,
         2.54,-3.58,

         //
        -8.4,-1.3,
        -6.58,-1.07,
        -6.64,-0.83,
        -6.75,-1.07,
        -6.83,-0.96,
        -6.90,-1.12,
        -6.9,-1.1,
        -7.04,-0.76,
        -7.16,-0.98,
        -7.29,-0.78,
        -7.3,-1,
        -7.63,-0.64,
        -7.87,-1.0,
        -8,-0.8,
        -8.12,-1,
        -8.23,-0.9,
        
        -6.58,-1.07,
        -6.04,-0.92,
        -6.17,-0.58,
        -6.26,-0.76,
        -6.36,-0.34,

        -6.08,-0.92,
        -5.32,-0.93,
        -5.67,-0.24,
        -5.89,-0.8,
        -6,-0.60,

        -5.32,-0.93,
        -4.13,-0.77,
        -4.32,-0.38,
        -4.44,-0.77,
        -4.61,-0.43,
        -4.73,-0.83,
        -4.9,-0.23,
        -5.03,-0.83,
        -5.18,-0.65,
        
        
          -4.13,-0.77,
          -3.5,-1,
          -3.59,-0.66,
          -3.71,-0.82,
          -3.95,-0.61,

        -3.5,-1,
        -1.9,-0.94,
        -2.57,-0.32,
        -2.86,-0.67,
        -3,-0.5,
        -3.15,-0.92,
        -3.29,-0.75,


        -8.2,-1.4,
        -1.9,-0.93,
        -1.9,-0.91,
        -3.5,-1,
        -4.13,-0.77,
        -5.32,-0.93,
        -6.08,-0.92,
        -8.19,-1.27,
        -8.39,-1.3,

        -1.5,-4,
        6,-4,
        2.3,-3.5,
      ];

    
      const estrellas = crearEstrellas([
  
        -8.0,  4.0,
        -7.5,  5.5,
        -7.0,  3.8,
        -6.5,  5.0,
        -6.0,  4.5,
        -5.5,  5.8,


        -8.0,  2.0,
        -7.2,  1.5,
        -6.8,  2.8,
        -5.5,  1.2,
        -5.0,  2.5,
        -4.5,  1.8,
 
        -4.0,  3.5,
        -3.5,  5.6,
        -3.0,  4.2,
        -2.5,  5.8,
        -2.0,  5.5,
        -1.5,  4.7,


  // derecha arriba
   1.0,  4.8,
   2.0,  5.4,
   3.5,  5.2,
   4.2,  4.6,
   5.0,  5.7,
   6.0,  4.0,
   8,  4.0,

  // derecha abajo
   2.5,  2.0,
   3.0,  1.7,
   4.0,  2.8,
   5.2,  1.9,
   6.5,  2.5,
   7.5,  1.8
]);


      const vao = gl.createVertexArray();
      gl.bindVertexArray(vao);

      const vbo = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
      gl.enableVertexAttribArray(0);
      gl.vertexAttribPointer(0,2,gl.FLOAT,false,0,0);


      const uColor = gl.getUniformLocation(programaID,"uColor");

      const uMatrizProyeccion = gl.getUniformLocation(programaID,"uMatrizProyeccion");
      const uMatrizVista = gl.getUniformLocation(programaID,"uMatrizVista");
      const uMatrizModelo = gl.getUniformLocation(programaID,"uMatrizModelo");

      const aspect = canvas.width / canvas.height;
      ortho(MatrizProyeccion, -10, 10, -5, 6, -1, 1);

      gl.uniformMatrix4fv(uMatrizProyeccion,false,MatrizProyeccion);

      identidad(MatrizVista);
      gl.uniformMatrix4fv(uMatrizVista,false,MatrizVista);

      identidad(MatrizModelo);
      gl.uniformMatrix4fv(uMatrizModelo,false,MatrizModelo);

      gl.clearColor(47/255,71/255,102/255,1);
      gl.clear(gl.COLOR_BUFFER_BIT);

      // Crear la luna
      const luna = crearCirculo(3, 0.5, 0.5, 80); // (radio, centroX, centroY, segmentos)
      gl.bindVertexArray(luna.vao);

      gl.uniform4f(uColor, 255/255, 190/255, 120/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 0, luna.numVertices);

       // estrellas
      gl.bindVertexArray(estrellas.vao);
      gl.uniform4f(uColor, 1.0, 1.0, 1.0, 1.0); // blancas
      gl.drawArrays(gl.POINTS, 0, estrellas.numVertices);


      gl.bindVertexArray(vao);

   

      gl.uniform4f(uColor, 12/255, 20/255, 40/255, 1.0);
      gl.drawArrays(gl.TRIANGLES, 0, 3);

      gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
      gl.drawArrays(gl.TRIANGLES, 3, 3);

      gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
      gl.drawArrays(gl.TRIANGLES, 6, 3);

      gl.uniform4f(uColor, 28/255, 47/255, 75/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 9, 4);

      gl.uniform4f(uColor, 22/255, 38/255, 66/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 13, 12);
        
      gl.uniform4f(uColor, 28/255, 47/255, 75/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 25, 4);
        
      gl.uniform4f(uColor, 17/255, 33/255, 60/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 29, 4);

      gl.uniform4f(uColor, 14/255, 28/255, 53/255, 1.0);
      gl.drawArrays(gl.TRIANGLES, 33, 3);

      gl.uniform4f(uColor, 16/255, 27/255, 55/255, 1.0);
      gl.drawArrays(gl.TRIANGLE_FAN, 36, 7);

        gl.uniform4f(uColor, 28/255, 47/255, 75/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 43, 10);


        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 53, 4);
        
        gl.uniform4f(uColor,138/255, 153/255, 159/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 57, 7);

        gl.uniform4f(uColor, 122/255, 139/255, 147/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 64, 6);
        
        gl.uniform4f(uColor, 90/255, 109/255, 121/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 72, 9);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 81, 3);

         gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 84, 4);

        gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 88, 4);

        gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 92, 4);

        gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 96, 4);

        gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 100, 4);

         gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 104, 4);

         gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 108, 4);

        gl.uniform4f(uColor, 42/255, 62/255, 90/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 112, 4);

        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 116, 6);

         gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 122, 3);

        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 125, 3);
        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 128, 3);
        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 131, 3);

        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 134, 3);
         gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 137, 3);
        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 140, 3);
        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 143, 3);
        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 146, 3);
         gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 149, 3);
        
        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 152, 3);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 155, 16);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 171, 5);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 176, 5);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 181, 9);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 190, 5);

        gl.uniform4f(uColor, 16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 195, 7);
        gl.uniform4f(uColor,  16/255, 27/255, 53/255, 1.0);
        gl.drawArrays(gl.TRIANGLE_FAN, 202, 9);

        gl.uniform4f(uColor, 12/255, 17/255, 26/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 211, 3);

        gl.uniform4f(uColor, 158/255, 186/255, 213/255, 1.0);
        gl.drawArrays(gl.TRIANGLES, 214, 4);


      gl.bindVertexArray(null);
    }

    window.onload = main;
  </script>
</body>
</html>
